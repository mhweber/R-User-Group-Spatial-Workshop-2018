---
title: Spatial Objects
---

## Lesson Goals

* Understand R representation of vector and raster spatial data
* Familiarity with R packages for reading, writing, and dealing with vector and raster data
* Understand spatial file types supported by R spatial packages
* Learn to pull spatial data from online sources into R

### Spatial Data Types
#### Simple Representation of Spatial Data and Supported Data Types

We can represent spatial data as discrete locations (points, lines or polygons) or as continuous phenomena without natural boundaries. We typiclaly represent the former type of dta as *vector* data, with an associated geometry or shape, and some attributes with information about the locations.  Examples are things like state boundaries with state name and population, rivers with their flow volume and names, polygons of watersheds with their names and associated landscape information.  We represent the latter type of data (continuous spatial fields) with *rasters* - these would be things such as elevation, precipitation, and atmospheric deposition for instance.


Basic data structures in R can represent spatial data - all we need is some vectors with location and attribute information - below we generate cites with population and make a map with a legend:

```{r cities}
cities <- c('Ashland','Corvallis','Bend','Portland','Newport')
longitude <- c(-122.699, -123.275, -121.313, -122.670, -124.054)
latitude <- c(42.189, 44.57, 44.061, 45.523, 44.652)
population <- c(20062,50297,61362,537557,9603)
locs <- cbind(longitude, latitude) 
plot(locs, cex=sqrt(population*.0002), pch=20, col='red', 
  main='Population', xlim = c(-124,-120.5), ylim = c(42, 46))
text(locs, cities, pos=4)

# Add a legend
breaks <- c(20000, 50000, 60000, 100000)
options(scipen=3)
legend("topright", legend=breaks, pch=20, pt.cex=1+breaks/20000, 
  col='red', bg='gray')
```

We can add a random polygon and map this as well:
```{r}
cities <- c('Ashland','Corvallis','Bend','Portland','Newport')
longitude <- c(-122.699, -123.275, -121.313, -122.670, -124.054)
latitude <- c(42.189, 44.57, 44.061, 45.523, 44.652)
population <- c(20062,50297,61362,537557,9603)
locs <- cbind(longitude, latitude) 
plot(locs, cex=sqrt(population*.0002), pch=20, col='red', 
  main='Population', xlim = c(-124,-120.5), ylim = c(42, 46))
text(locs, cities, pos=4)

# Add a legend
breaks <- c(20000, 50000, 60000, 100000)
options(scipen=3)
legend("topright", legend=breaks, pch=20, pt.cex=1+breaks/20000, 
  col='red', bg='gray')

# Add polygon
lon <- c(-123.5, -123.5, -122.5, -122.670, -123)
lat <- c(43, 45.5, 44, 43, 43)
x <- cbind(lon, lat)
polygon(x, border='blue')
lines(x, lwd=3, col='red')
points(x, cex=2, pch=20)
```

We can see in this toy example that numeric vectors can represent locations in R for simple mapping.  Points just need to be a pair of numbers in cartesian space, lines and polygons are just a number of these points (note that polygons are closed by having their first point coincide with last point which the `polygon` function in base R graphics takes care of). 

You can do simple things with this spatial representation using basic R structures, but it breaks down quickly if you want to ask any spatial questions - for instance using the example above, how would we figure out the nearest city to Corvallis? Or imagine the polygon is a county and we wanted to know what cities are within the county?

So what information do we need to properly define spatial vector data and perform spatial operations?

* A coordinate reference system
* A bounding box or extent
* ?

### Vector Data with sp
we're going to quickly review how spatial data was standardized in recent years using the base package `sp`.  It's informative to understand the structure of `sp` objects, and a number of packages still depend on `sp`, but this is changing rapidly and the R spatial vector world is rapdily moving toward adaptation of the newer `sf` package, so the bulk of our vector work will be using `sf`.

One reason it's worth still going over `sp`, even though you'll soon find `sf` is far superior in a number of ways, is that numerous packages are currently built using `sp` object structure, so there's a need to learn it to navigate current R spatial ecosystem - image below from [Colin Gillespie's Tweet](https://twitter.com/csgillespie/status/854438264538845184):

![CRANdependencies](/R-User-Group-Spatial-Workshop-2018/img/CRANdependencies.jpg)

```{r packages}
devtools::install_github("metacran/cranlogs")
library(cranlogs)
library(ggplot2)
library(lubridate)
stats <- cran_downloads(from = "2013-01-01", to = "2018-08-22",packages = c("sp", "sf", "raster", "ggmap", "mapview"))

monthly_stats <- stats %>% 
  group_by(month=floor_date(date, "month"), package) %>%
  summarize(amount=sum(count))
ggplot(monthly_stats, aes(x=month, y=amount, group = package, colour = package)) + geom_line() 
```

### Vector Data with sf

### Raster Data

### Getting Data 
#### Downloading Open Data and Geographic Data Packages

### Geographic Data I/O